-- RoohrHub UI Library v2.0
-- Improved architecture, performance, and features

print("RoohrLib v2.0")

-- Services
local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local TextService = game:GetService("TextService")
local Debris = game:GetService("Debris")

local player = Players.LocalPlayer

-- Constants
local CONSTANTS = {
    MAIN_SIZE = Vector2.new(620, 420),
    MINIMIZED_SIZE = Vector2.new(250, 50),
    TAB_HEIGHT = 38,
    BUTTON_HEIGHT = 42,
    SLIDER_HEIGHT = 60,
    ANIMATION_SPEED = 0.2,
    DRAG_ANIMATION_SPEED = 0.1,
    NOTIFICATION_DURATION = 3,
    MAX_NOTIFICATIONS = 5,
    CORNER_RADIUS = UDim.new(0, 10)
}

-- Enhanced Theme System
local Theme = {
    Background = Color3.fromRGB(15, 15, 15),
    Panel = Color3.fromRGB(20, 20, 20),
    Element = Color3.fromRGB(28, 28, 28),
    ElementHover = Color3.fromRGB(35, 35, 35),
    Accent = Color3.fromRGB(255, 105, 180),
    AccentDark = Color3.fromRGB(219, 112, 147),
    Text = Color3.fromRGB(245, 245, 245),
    Muted = Color3.fromRGB(150, 150, 150),
    Border = Color3.fromRGB(40, 40, 40),
    Success = Color3.fromRGB(76, 175, 80),
    Warning = Color3.fromRGB(255, 152, 0),
    Error = Color3.fromRGB(244, 67, 54),
    Info = Color3.fromRGB(33, 150, 243)
}

-- Settings
local Settings = {
    SoundsEnabled = true,
    MinimizeKey = Enum.KeyCode.RightControl,
    AnimationsEnabled = true,
    NotificationSounds = true,
    MaxNotifications = CONSTANTS.MAX_NOTIFICATIONS,
    SaveConfig = true
}

-- Connection Manager for cleanup
local ConnectionManager = {}
ConnectionManager.__index = ConnectionManager

function ConnectionManager.new()
    local self = setmetatable({}, ConnectionManager)
    self.connections = {}
    self.tweens = {}
    return self
end

function ConnectionManager:Add(connection)
    table.insert(self.connections, connection)
    return connection
end

function ConnectionManager:AddTween(tween)
    table.insert(self.tweens, tween)
    return tween
end

function ConnectionManager:DisconnectAll()
    for _, conn in ipairs(self.connections) do
        if conn.Connected then
            conn:Disconnect()
        end
    end
    for _, tween in ipairs(self.tweens) do
        tween:Cancel()
    end
    self.connections = {}
    self.tweens = {}
end

-- Utility Functions
local Utils = {}

function Utils.PlaySound(soundId, volume)
    if not Settings.SoundsEnabled then return end
    
    local sound = Instance.new("Sound")
    sound.SoundId = soundId or "rbxassetid://87437544236708"
    sound.Volume = volume or 0.3
    sound.Parent = workspace
    sound:Play()
    Debris:AddItem(sound, 1)
end

function Utils.Tween(object, properties, duration, style, direction)
    if not Settings.AnimationsEnabled then
        for prop, value in pairs(properties) do
            object[prop] = value
        end
        return
    end
    
    local info = TweenInfo.new(
        duration or CONSTANTS.ANIMATION_SPEED,
        style or Enum.EasingStyle.Quad,
        direction or Enum.EasingDirection.Out
    )
    local tween = TweenService:Create(object, info, properties)
    tween:Play()
    return tween
end

function Utils.CreateCorner(parent, radius)
    local corner = Instance.new("UICorner")
    corner.CornerRadius = radius or CONSTANTS.CORNER_RADIUS
    corner.Parent = parent
    return corner
end

function Utils.CreateStroke(parent, color, thickness, transparency)
    local stroke = Instance.new("UIStroke")
    stroke.Color = color or Theme.Border
    stroke.Thickness = thickness or 1
    stroke.Transparency = transparency or 0.8
    stroke.Parent = parent
    return stroke
end

function Utils.CreatePadding(parent, padding)
    local pad = Instance.new("UIPadding")
    if type(padding) == "number" then
        pad.PaddingTop = UDim.new(0, padding)
        pad.PaddingBottom = UDim.new(0, padding)
        pad.PaddingLeft = UDim.new(0, padding)
        pad.PaddingRight = UDim.new(0, padding)
    else
        pad.PaddingTop = UDim.new(0, padding.Top or 0)
        pad.PaddingBottom = UDim.new(0, padding.Bottom or 0)
        pad.PaddingLeft = UDim.new(0, padding.Left or 0)
        pad.PaddingRight = UDim.new(0, padding.Right or 0)
    end
    pad.Parent = parent
    return pad
end

function Utils.CalculateTextSize(text, textSize, font, maxWidth)
    return TextService:GetTextSize(text, textSize, font, Vector2.new(maxWidth, math.huge))
end

function Utils.Debounce(func, delay)
    local lastRun = 0
    return function(...)
        local now = tick()
        if now - lastRun >= delay then
            lastRun = now
            func(...)
        end
    end
end

-- GUI
local gui = Instance.new("ScreenGui")
gui.Name = "RoohrHub"
gui.ResetOnSpawn = false
gui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
gui.Parent = player:WaitForChild("PlayerGui")

-- Main Frame
local main = Instance.new("Frame")
main.Size = UDim2.new(0, CONSTANTS.MAIN_SIZE.X, 0, CONSTANTS.MAIN_SIZE.Y)
main.Position = UDim2.new(0.5, 0, 0.5, 0)
main.AnchorPoint = Vector2.new(0.5, 0.5)
main.BackgroundColor3 = Theme.Background
main.BorderSizePixel = 0
main.ClipsDescendants = false
main.Parent = gui

Utils.CreateCorner(main, UDim.new(0, 16))
Utils.CreateStroke(main, Theme.Border, 1, 0.5)

-- Top Bar
local top = Instance.new("Frame")
top.Size = UDim2.new(1, 0, 0, 50)
top.BackgroundColor3 = Theme.Panel
top.BorderSizePixel = 0
top.Parent = main

Utils.CreateCorner(top, UDim.new(0, 16))

-- Fix corner on bottom by adding cover
local topCover = Instance.new("Frame")
topCover.Size = UDim2.new(1, 0, 0, 16)
topCover.Position = UDim2.new(0, 0, 1, -16)
topCover.BackgroundColor3 = Theme.Panel
topCover.BorderSizePixel = 0
topCover.Parent = top

-- Logo Container
local logoContainer = Instance.new("Frame")
logoContainer.Size = UDim2.new(0, 36, 0, 36)
logoContainer.Position = UDim2.new(0, 8, 0, 7)
logoContainer.BackgroundTransparency = 1
logoContainer.Parent = top

local logo = Instance.new("ImageLabel")
logo.Size = UDim2.new(1, 0, 1, 0)
logo.BackgroundTransparency = 1
logo.Image = "rbxassetid://97046632760597"
logo.ImageColor3 = Theme.Accent
logo.Parent = logoContainer

-- Title
local title = Instance.new("TextLabel")
title.Size = UDim2.new(1, -180, 1, 0)
title.Position = UDim2.new(0, 50, 0, 0)
title.BackgroundTransparency = 1
title.Text = "RoohrHub"
title.Font = Enum.Font.GothamBold
title.TextSize = 22
title.TextColor3 = Theme.Text
title.TextXAlignment = Enum.TextXAlignment.Left
title.Parent = top

-- Subtitle
local subtitle = Instance.new("TextLabel")
subtitle.Size = UDim2.new(1, -180, 0, 12)
subtitle.Position = UDim2.new(0, 50, 0, 28)
subtitle.BackgroundTransparency = 1
subtitle.Text = "v2.0 • " .. player.Name
subtitle.Font = Enum.Font.Gotham
subtitle.TextSize = 11
subtitle.TextColor3 = Theme.Muted
subtitle.TextXAlignment = Enum.TextXAlignment.Left
subtitle.Parent = top

-- Control Buttons Container
local controlsContainer = Instance.new("Frame")
controlsContainer.Size = UDim2.new(0, 80, 0, 36)
controlsContainer.Position = UDim2.new(1, -88, 0, 7)
controlsContainer.BackgroundTransparency = 1
controlsContainer.Parent = top

local controlsLayout = Instance.new("UIListLayout")
controlsLayout.Padding = UDim.new(0, 8)
controlsLayout.FillDirection = Enum.FillDirection.Horizontal
controlsLayout.HorizontalAlignment = Enum.HorizontalAlignment.Right
controlsLayout.SortOrder = Enum.SortOrder.LayoutOrder
controlsLayout.Parent = controlsContainer

-- Minimize Button
local minimizeBtn = Instance.new("TextButton")
minimizeBtn.Size = UDim2.new(0, 36, 0, 36)
minimizeBtn.BackgroundColor3 = Theme.Element
minimizeBtn.Text = "−"
minimizeBtn.Font = Enum.Font.GothamBold
minimizeBtn.TextSize = 20
minimizeBtn.TextColor3 = Theme.Text
minimizeBtn.AutoButtonColor = false
minimizeBtn.LayoutOrder = 1
minimizeBtn.Parent = controlsContainer

Utils.CreateCorner(minimizeBtn, UDim.new(0, 8))

local minConnections = ConnectionManager.new()

minConnections:Add(minimizeBtn.MouseEnter:Connect(function()
    Utils.Tween(minimizeBtn, {BackgroundColor3 = Theme.ElementHover})
end))

minConnections:Add(minimizeBtn.MouseLeave:Connect(function()
    Utils.Tween(minimizeBtn, {BackgroundColor3 = Theme.Element})
end))

local isMinimized = false
minConnections:Add(minimizeBtn.MouseButton1Click:Connect(function()
    isMinimized = not isMinimized
    if isMinimized then
        Utils.Tween(main, {
            Size = UDim2.new(0, CONSTANTS.MINIMIZED_SIZE.X, 0, CONSTANTS.MINIMIZED_SIZE.Y)
        }, 0.3)
        minimizeBtn.Text = "□"
        if tabs then tabs.Visible = false end
        if pages then pages.Visible = false end
        if profileFrame then profileFrame.Visible = false end
        if accent then accent.Visible = false end
    else
        Utils.Tween(main, {
            Size = UDim2.new(0, CONSTANTS.MAIN_SIZE.X, 0, CONSTANTS.MAIN_SIZE.Y)
        }, 0.3)
        minimizeBtn.Text = "−"
        if tabs then tabs.Visible = true end
        if pages then pages.Visible = true end
        if profileFrame then profileFrame.Visible = true end
        if accent then accent.Visible = true end
    end
    Utils.PlaySound()
end))

-- Minimize keybind
minConnections:Add(UIS.InputBegan:Connect(function(input, gameProcessed)
    if not gameProcessed and input.KeyCode == Settings.MinimizeKey then
        minimizeBtn.MouseButton1Click:Fire()
    end
end))

-- Animated Accent Bar
local accent = Instance.new("Frame")
accent.Size = UDim2.new(1, 0, 0, 3)
accent.Position = UDim2.new(0, 0, 1, -3)
accent.BackgroundColor3 = Theme.Accent
accent.BorderSizePixel = 0
accent.Parent = top

local accentGradient = Instance.new("UIGradient")
accentGradient.Color = ColorSequence.new({
    ColorSequenceKeypoint.new(0, Theme.Accent),
    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(255, 255, 255)),
    ColorSequenceKeypoint.new(1, Theme.Accent)
})
accentGradient.Parent = accent

task.spawn(function()
    while accent and accent.Parent do
        Utils.Tween(accentGradient, {Offset = Vector2.new(1, 0)}, 3, Enum.EasingStyle.Linear)
        task.wait(3)
        accentGradient.Offset = Vector2.new(-1, 0)
    end
end)

-- Sidebar Tabs
local tabs = Instance.new("Frame")
tabs.Size = UDim2.new(0, 150, 1, -136) -- Made smaller to fit profile
tabs.Position = UDim2.new(0, 4, 0, 54)
tabs.BackgroundColor3 = Theme.Panel
tabs.BorderSizePixel = 0
tabs.Parent = main

Utils.CreateCorner(tabs, UDim.new(0, 12))
Utils.CreatePadding(tabs, {Top = 8, Bottom = 8, Left = 6, Right = 6})

local tabsLayout = Instance.new("UIListLayout")
tabsLayout.Padding = UDim.new(0, 6)
tabsLayout.FillDirection = Enum.FillDirection.Vertical
tabsLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
tabsLayout.VerticalAlignment = Enum.VerticalAlignment.Top
tabsLayout.SortOrder = Enum.SortOrder.LayoutOrder
tabsLayout.Parent = tabs

-- Profile Section at bottom
local profileFrame = Instance.new("Frame")
profileFrame.Size = UDim2.new(0, 150, 0, 76)
profileFrame.Position = UDim2.new(0, 4, 1, -80)
profileFrame.BackgroundColor3 = Theme.Panel
profileFrame.BorderSizePixel = 0
profileFrame.Parent = main

Utils.CreateCorner(profileFrame, UDim.new(0, 12))
Utils.CreatePadding(profileFrame, 8)

-- Get HWID (using UserId as alternative since real HWID isn't accessible)
local function getHWID()
    -- In a real executor environment, you'd use gethwid() or similar
    -- For now, we'll use a combination of UserId and a hash
    local userId = player.UserId
    return string.format("%08X", userId)
end

-- Profile Picture
local profilePicture = Instance.new("ImageLabel")
profilePicture.Size = UDim2.new(0, 48, 0, 48)
profilePicture.Position = UDim2.new(0, 8, 0, 8)
profilePicture.BackgroundColor3 = Theme.Element
profilePicture.BorderSizePixel = 0
profilePicture.Image = "rbxthumb://type=AvatarHeadShot&id=" .. player.UserId .. "&w=48&h=48"
profilePicture.Parent = profileFrame

Utils.CreateCorner(profilePicture, UDim.new(0, 8))
Utils.CreateStroke(profilePicture, Theme.Accent, 2, 0.5)

-- Profile Info Container
local profileInfo = Instance.new("Frame")
profileInfo.Size = UDim2.new(1, -64, 1, -16)
profileInfo.Position = UDim2.new(0, 60, 0, 8)
profileInfo.BackgroundTransparency = 1
profileInfo.Parent = profileFrame

-- Username
local usernameLabel = Instance.new("TextLabel")
usernameLabel.Size = UDim2.new(1, 0, 0, 18)
usernameLabel.Position = UDim2.new(0, 0, 0, 4)
usernameLabel.BackgroundTransparency = 1
usernameLabel.Text = player.Name
usernameLabel.Font = Enum.Font.GothamBold
usernameLabel.TextSize = 13
usernameLabel.TextColor3 = Theme.Text
usernameLabel.TextXAlignment = Enum.TextXAlignment.Left
usernameLabel.TextTruncate = Enum.TextTruncate.AtEnd
usernameLabel.Parent = profileInfo

-- Display Name (if different)
local displayName = player.DisplayName
if displayName ~= player.Name then
    usernameLabel.Text = displayName
    usernameLabel.Size = UDim2.new(1, 0, 0, 14)
    usernameLabel.TextSize = 12
    
    local realNameLabel = Instance.new("TextLabel")
    realNameLabel.Size = UDim2.new(1, 0, 0, 12)
    realNameLabel.Position = UDim2.new(0, 0, 0, 16)
    realNameLabel.BackgroundTransparency = 1
    realNameLabel.Text = "@" .. player.Name
    realNameLabel.Font = Enum.Font.Gotham
    realNameLabel.TextSize = 10
    realNameLabel.TextColor3 = Theme.Muted
    realNameLabel.TextXAlignment = Enum.TextXAlignment.Left
    realNameLabel.TextTruncate = Enum.TextTruncate.AtEnd
    realNameLabel.Parent = profileInfo
end

-- HWID Label
local hwidLabel = Instance.new("TextLabel")
hwidLabel.Size = UDim2.new(1, 0, 0, 14)
hwidLabel.Position = UDim2.new(0, 0, 1, -18)
hwidLabel.BackgroundTransparency = 1
hwidLabel.Text = "HWID: " .. getHWID()
hwidLabel.Font = Enum.Font.Code
hwidLabel.TextSize = 9
hwidLabel.TextColor3 = Theme.Muted
hwidLabel.TextXAlignment = Enum.TextXAlignment.Left
hwidLabel.TextTruncate = Enum.TextTruncate.AtEnd
hwidLabel.Parent = profileInfo

-- Online Status Indicator
local statusDot = Instance.new("Frame")
statusDot.Size = UDim2.new(0, 8, 0, 8)
statusDot.Position = UDim2.new(1, -12, 0, 4)
statusDot.BackgroundColor3 = Theme.Success
statusDot.BorderSizePixel = 0
statusDot.Parent = profilePicture

Utils.CreateCorner(statusDot, UDim.new(1, 0))

-- Pulse animation for status dot
task.spawn(function()
    while statusDot and statusDot.Parent do
        Utils.Tween(statusDot, {BackgroundTransparency = 0.3}, 1, Enum.EasingStyle.Quad)
        task.wait(1)
        Utils.Tween(statusDot, {BackgroundTransparency = 0}, 1, Enum.EasingStyle.Quad)
        task.wait(1)
    end
end)

-- Pages Container
local pages = Instance.new("Frame")
pages.Size = UDim2.new(1, -164, 1, -60)
pages.Position = UDim2.new(0, 158, 0, 56)
pages.BackgroundTransparency = 1
pages.Parent = main

-- Notification Container
local notifContainer = Instance.new("Frame")
notifContainer.Size = UDim2.new(0, 320, 1, 0)
notifContainer.Position = UDim2.new(1, -330, 0, 10)
notifContainer.BackgroundTransparency = 1
notifContainer.Parent = gui

local notifLayout = Instance.new("UIListLayout")
notifLayout.Padding = UDim.new(0, 8)
notifLayout.FillDirection = Enum.FillDirection.Vertical
notifLayout.HorizontalAlignment = Enum.HorizontalAlignment.Right
notifLayout.VerticalAlignment = Enum.VerticalAlignment.Top
notifLayout.SortOrder = Enum.SortOrder.LayoutOrder
notifLayout.Parent = notifContainer

-- Drag Functionality
local dragConnections = ConnectionManager.new()
do
    local dragging, startPos, startInput
    
    dragConnections:Add(top.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 and not isMinimized then
            dragging = true
            startInput = input.Position
            startPos = main.Position
            Utils.Tween(main, {Size = UDim2.new(0, CONSTANTS.MAIN_SIZE.X - 5, 0, CONSTANTS.MAIN_SIZE.Y - 5)}, CONSTANTS.DRAG_ANIMATION_SPEED)
        end
    end))
    
    dragConnections:Add(UIS.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
            if not isMinimized then
                Utils.Tween(main, {Size = UDim2.new(0, CONSTANTS.MAIN_SIZE.X, 0, CONSTANTS.MAIN_SIZE.Y)}, CONSTANTS.DRAG_ANIMATION_SPEED)
            end
        end
    end))
    
    dragConnections:Add(UIS.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = input.Position - startInput
            main.Position = startPos + UDim2.new(0, delta.X, 0, delta.Y)
        end
    end))
end

-- Library Object
local Library = {}
Library.Tabs = {}
Library.Notifications = {}
Library.Connections = ConnectionManager.new()
Library.ActiveNotifications = 0

-- Enhanced Notification System
function Library:Notify(options, ...)
    -- Support both old and new API
    local title, message, duration, notifType
    
    if type(options) == "table" then
        title = options.Title or options.title or "Notification"
        message = options.Message or options.message or ""
        duration = options.Duration or options.duration or CONSTANTS.NOTIFICATION_DURATION
        notifType = options.Type or options.type or "info"
    else
        -- Legacy API support
        local args = {...}
        title = options or "Notification"
        message = args[1] or ""
        duration = args[2] or CONSTANTS.NOTIFICATION_DURATION
        notifType = args[3] or "info"
    end
    
    -- Limit notifications
    if self.ActiveNotifications >= Settings.MaxNotifications then
        -- Remove oldest notification
        if #self.Notifications > 0 then
            local oldest = self.Notifications[1]
            if oldest and oldest.Parent then
                oldest:Destroy()
            end
            table.remove(self.Notifications, 1)
            self.ActiveNotifications = self.ActiveNotifications - 1
        end
    end
    
    local typeColors = {
        info = Theme.Info,
        success = Theme.Success,
        warning = Theme.Warning,
        error = Theme.Error
    }
    
    local typeIcons = {
        info = "ℹ",
        success = "✓",
        warning = "⚠",
        error = "✕"
    }
    
    local notif = Instance.new("Frame")
    notif.Size = UDim2.new(1, 0, 0, 0)
    notif.BackgroundColor3 = Theme.Panel
    notif.BorderSizePixel = 0
    notif.ClipsDescendants = true
    notif.Parent = notifContainer
    
    Utils.CreateCorner(notif)
    Utils.CreateStroke(notif, typeColors[notifType], 2, 0)
    
    -- Accent bar
    local notifAccent = Instance.new("Frame")
    notifAccent.Size = UDim2.new(0, 4, 1, 0)
    notifAccent.BackgroundColor3 = typeColors[notifType]
    notifAccent.BorderSizePixel = 0
    notifAccent.Parent = notif
    
    -- Icon
    local icon = Instance.new("TextLabel")
    icon.Size = UDim2.new(0, 24, 0, 24)
    icon.Position = UDim2.new(0, 12, 0, 8)
    icon.BackgroundTransparency = 1
    icon.Text = typeIcons[notifType]
    icon.Font = Enum.Font.GothamBold
    icon.TextSize = 18
    icon.TextColor3 = typeColors[notifType]
    icon.Parent = notif
    
    -- Title
    local notifTitle = Instance.new("TextLabel")
    notifTitle.Size = UDim2.new(1, -90, 0, 20)
    notifTitle.Position = UDim2.new(0, 44, 0, 8)
    notifTitle.BackgroundTransparency = 1
    notifTitle.Text = title
    notifTitle.Font = Enum.Font.GothamBold
    notifTitle.TextSize = 14
    notifTitle.TextColor3 = Theme.Text
    notifTitle.TextXAlignment = Enum.TextXAlignment.Left
    notifTitle.TextTruncate = Enum.TextTruncate.AtEnd
    notifTitle.Parent = notif
    
    -- Message
    local notifMessage = Instance.new("TextLabel")
    notifMessage.Size = UDim2.new(1, -90, 0, 0)
    notifMessage.Position = UDim2.new(0, 44, 0, 28)
    notifMessage.BackgroundTransparency = 1
    notifMessage.Text = message
    notifMessage.Font = Enum.Font.Gotham
    notifMessage.TextSize = 12
    notifMessage.TextColor3 = Theme.Muted
    notifMessage.TextXAlignment = Enum.TextXAlignment.Left
    notifMessage.TextWrapped = true
    notifMessage.TextYAlignment = Enum.TextYAlignment.Top
    notifMessage.Parent = notif
    
    -- Calculate height
    local textHeight = Utils.CalculateTextSize(message, 12, Enum.Font.Gotham, notifMessage.AbsoluteSize.X).Y
    local totalHeight = math.max(60, textHeight + 45)
    notifMessage.Size = UDim2.new(1, -90, 0, textHeight)
    
    -- Close button
    local closeBtn = Instance.new("TextButton")
    closeBtn.Size = UDim2.new(0, 24, 0, 24)
    closeBtn.Position = UDim2.new(1, -32, 0, 8)
    closeBtn.BackgroundTransparency = 1
    closeBtn.Text = "×"
    closeBtn.Font = Enum.Font.GothamBold
    closeBtn.TextSize = 20
    closeBtn.TextColor3 = Theme.Muted
    closeBtn.Parent = notif
    
    closeBtn.MouseEnter:Connect(function()
        Utils.Tween(closeBtn, {TextColor3 = Theme.Text})
    end)
    
    closeBtn.MouseLeave:Connect(function()
        Utils.Tween(closeBtn, {TextColor3 = Theme.Muted})
    end)
    
    -- Animate in
    Utils.Tween(notif, {Size = UDim2.new(1, 0, 0, totalHeight)}, 0.3)
    self.ActiveNotifications = self.ActiveNotifications + 1
    
    -- Auto close
    local function closeNotif()
        Utils.Tween(notif, {Size = UDim2.new(1, 0, 0, 0)}, 0.3)
        task.wait(0.3)
        if notif and notif.Parent then
            notif:Destroy()
            self.ActiveNotifications = math.max(0, self.ActiveNotifications - 1)
        end
    end
    
    closeBtn.MouseButton1Click:Connect(function()
        Utils.PlaySound()
        closeNotif()
    end)
    
    task.delay(duration, closeNotif)
    
    table.insert(self.Notifications, notif)
    
    if Settings.NotificationSounds then
        Utils.PlaySound()
    end
    
    return notif
end

-- Create Tab
function Library:CreateTab(name, icon)
    icon = icon or "●"
    
    local tab = Instance.new("TextButton")
    tab.Size = UDim2.new(1, 0, 0, CONSTANTS.TAB_HEIGHT)
    tab.Text = ""
    tab.BackgroundColor3 = Theme.Element
    tab.BorderSizePixel = 0
    tab.AutoButtonColor = false
    tab.Parent = tabs
    
    Utils.CreateCorner(tab)
    local tabStroke = Utils.CreateStroke(tab)
    
    local tabIcon = Instance.new("TextLabel")
    tabIcon.Size = UDim2.new(0, 20, 0, 20)
    tabIcon.Position = UDim2.new(0, 10, 0.5, -10)
    tabIcon.BackgroundTransparency = 1
    tabIcon.Text = icon
    tabIcon.Font = Enum.Font.GothamBold
    tabIcon.TextSize = 16
    tabIcon.TextColor3 = Theme.Muted
    tabIcon.Parent = tab
    
    local tabLabel = Instance.new("TextLabel")
    tabLabel.Size = UDim2.new(1, -40, 1, 0)
    tabLabel.Position = UDim2.new(0, 35, 0, 0)
    tabLabel.BackgroundTransparency = 1
    tabLabel.Text = name
    tabLabel.Font = Enum.Font.GothamBold
    tabLabel.TextSize = 14
    tabLabel.TextColor3 = Theme.Muted
    tabLabel.TextXAlignment = Enum.TextXAlignment.Left
    tabLabel.TextTruncate = Enum.TextTruncate.AtEnd
    tabLabel.Parent = tab
    
    -- Hover effects
    tab.MouseEnter:Connect(function()
        if not tab:FindFirstChild("Selected") then
            Utils.Tween(tab, {BackgroundColor3 = Theme.ElementHover})
        end
    end)
    
    tab.MouseLeave:Connect(function()
        if not tab:FindFirstChild("Selected") then
            Utils.Tween(tab, {BackgroundColor3 = Theme.Element})
        end
    end)
    
    -- Page
    local page = Instance.new("ScrollingFrame")
    page.Size = UDim2.new(1, 0, 1, 0)
    page.Visible = false
    page.BackgroundTransparency = 1
    page.BorderSizePixel = 0
    page.ScrollBarThickness = 6
    page.ScrollBarImageColor3 = Theme.Accent
    page.CanvasSize = UDim2.new(0, 0, 0, 0)
    page.AutomaticCanvasSize = Enum.AutomaticSize.Y
    page.Parent = pages
    
    Utils.CreatePadding(page, {Top = 4, Bottom = 4, Left = 4, Right = 8})
    
    local layout = Instance.new("UIListLayout")
    layout.Padding = UDim.new(0, 8)
    layout.SortOrder = Enum.SortOrder.LayoutOrder
    layout.Parent = page
    
    -- Tab click handler
    tab.MouseButton1Click:Connect(function()
        -- Deselect all tabs
        for _, t in pairs(self.Tabs) do
            t.Page.Visible = false
            Utils.Tween(t.Button, {BackgroundColor3 = Theme.Element})
            Utils.Tween(t.Label, {TextColor3 = Theme.Muted})
            Utils.Tween(t.Icon, {TextColor3 = Theme.Muted})
            Utils.Tween(t.Stroke, {Transparency = 0.8})
            
            local selectedMarker = t.Button:FindFirstChild("Selected")
            if selectedMarker then
                selectedMarker:Destroy()
            end
        end
        
        -- Select this tab
        page.Visible = true
        local selected = Instance.new("BoolValue")
        selected.Name = "Selected"
        selected.Parent = tab
        
        Utils.Tween(tab, {BackgroundColor3 = Theme.Accent})
        Utils.Tween(tabLabel, {TextColor3 = Theme.Text})
        Utils.Tween(tabIcon, {TextColor3 = Theme.Text})
        Utils.Tween(tabStroke, {Transparency = 0.3})
        
        Utils.PlaySound()
    end)
    
    -- Auto-select first tab
    if #self.Tabs == 0 then
        page.Visible = true
        local selected = Instance.new("BoolValue")
        selected.Name = "Selected"
        selected.Parent = tab
        tab.BackgroundColor3 = Theme.Accent
        tabLabel.TextColor3 = Theme.Text
        tabIcon.TextColor3 = Theme.Text
        tabStroke.Transparency = 0.3
    end
    
    local Tab = {
        Page = page,
        Button = tab,
        Label = tabLabel,
        Icon = tabIcon,
        Stroke = tabStroke,
        Connections = ConnectionManager.new()
    }
    
    -- Component creation helper
    local function createButton(text)
        local btn = Instance.new("TextButton")
        btn.Size = UDim2.new(1, 0, 0, CONSTANTS.BUTTON_HEIGHT)
        btn.Text = ""
        btn.BackgroundColor3 = Theme.Element
        btn.BorderSizePixel = 0
        btn.AutoButtonColor = false
        btn.Parent = page
        
        Utils.CreateCorner(btn)
        Utils.CreateStroke(btn)
        
        local label = Instance.new("TextLabel")
        label.Size = UDim2.new(1, -16, 1, 0)
        label.Position = UDim2.new(0, 12, 0, 0)
        label.BackgroundTransparency = 1
        label.Text = text
        label.Font = Enum.Font.Gotham
        label.TextSize = 14
        label.TextColor3 = Theme.Text
        label.TextXAlignment = Enum.TextXAlignment.Left
        label.TextTruncate = Enum.TextTruncate.AtEnd
        label.Parent = btn
        
        local hoverConnection = btn.MouseEnter:Connect(function()
            Utils.Tween(btn, {BackgroundColor3 = Theme.ElementHover}, 0.15)
        end)
        
        local leaveConnection = btn.MouseLeave:Connect(function()
            if not btn:FindFirstChild("Active") then
                Utils.Tween(btn, {BackgroundColor3 = Theme.Element}, 0.15)
            end
        end)
        
        return btn, label, hoverConnection, leaveConnection
    end
    
    -- Add Button
    function Tab:AddButton(text, callback)
        local btn, label, hoverConn, leaveConn = createButton(text)
        
        Tab.Connections:Add(hoverConn)
        Tab.Connections:Add(leaveConn)
        
        Tab.Connections:Add(btn.MouseButton1Click:Connect(function()
            -- Click animation
            Utils.Tween(btn, {Size = UDim2.new(1, -4, 0, CONSTANTS.BUTTON_HEIGHT - 2)}, 0.1)
            task.wait(0.1)
            Utils.Tween(btn, {Size = UDim2.new(1, 0, 0, CONSTANTS.BUTTON_HEIGHT)}, 0.1)
            Utils.PlaySound()
            
            if callback then
                pcall(callback)
            end
        end))
        
        return btn
    end
    
    -- Add Toggle
    function Tab:AddToggle(text, default, callback)
        local state = default or false
        local btn, label, hoverConn, leaveConn = createButton(text)
        
        Tab.Connections:Add(hoverConn)
        Tab.Connections:Add(leaveConn)
        
        local indicator = Instance.new("Frame")
        indicator.Size = UDim2.new(0, 44, 0, 24)
        indicator.Position = UDim2.new(1, -52, 0.5, -12)
        indicator.BackgroundColor3 = state and Theme.Accent or Theme.Panel
        indicator.BorderSizePixel = 0
        indicator.Parent = btn
        
        Utils.CreateCorner(indicator, UDim.new(1, 0))
        
        local knob = Instance.new("Frame")
        knob.Size = UDim2.new(0, 18, 0, 18)
        knob.Position = state and UDim2.new(1, -21, 0.5, -9) or UDim2.new(0, 3, 0.5, -9)
        knob.BackgroundColor3 = Theme.Text
        knob.BorderSizePixel = 0
        knob.Parent = indicator
        
        Utils.CreateCorner(knob, UDim.new(1, 0))
        
        local function update()
            state = not state
            
            Utils.Tween(indicator, {BackgroundColor3 = state and Theme.Accent or Theme.Panel})
            Utils.Tween(knob, {Position = state and UDim2.new(1, -21, 0.5, -9) or UDim2.new(0, 3, 0.5, -9)}, 0.2, Enum.EasingStyle.Quad)
            
            if state then
                local active = Instance.new("BoolValue")
                active.Name = "Active"
                active.Parent = btn
                Utils.Tween(btn, {BackgroundColor3 = Theme.ElementHover})
            else
                local active = btn:FindFirstChild("Active")
                if active then
                    active:Destroy()
                end
                Utils.Tween(btn, {BackgroundColor3 = Theme.Element})
            end
            
            Utils.PlaySound()
            
            if callback then
                pcall(callback, state)
            end
        end
        
        Tab.Connections:Add(btn.MouseButton1Click:Connect(update))
        
        return btn, {
            SetValue = function(value)
                if value ~= state then
                    update()
                end
            end,
            GetValue = function()
                return state
            end
        }
    end
    
    -- Add Slider with improved performance
    function Tab:AddSlider(text, min, max, default, callback)
        default = math.clamp(default or min, min, max)
        
        local sliderFrame = Instance.new("Frame")
        sliderFrame.Size = UDim2.new(1, 0, 0, CONSTANTS.SLIDER_HEIGHT)
        sliderFrame.BackgroundColor3 = Theme.Element
        sliderFrame.BorderSizePixel = 0
        sliderFrame.Parent = page
        
        Utils.CreateCorner(sliderFrame)
        Utils.CreateStroke(sliderFrame)
        
        local sliderLabel = Instance.new("TextLabel")
        sliderLabel.Size = UDim2.new(0.6, 0, 0, 20)
        sliderLabel.Position = UDim2.new(0, 12, 0, 8)
        sliderLabel.BackgroundTransparency = 1
        sliderLabel.Text = text
        sliderLabel.Font = Enum.Font.GothamBold
        sliderLabel.TextSize = 13
        sliderLabel.TextColor3 = Theme.Text
        sliderLabel.TextXAlignment = Enum.TextXAlignment.Left
        sliderLabel.Parent = sliderFrame
        
        local valueLabel = Instance.new("TextLabel")
        valueLabel.Size = UDim2.new(0.4, -12, 0, 20)
        valueLabel.Position = UDim2.new(0.6, 0, 0, 8)
        valueLabel.BackgroundTransparency = 1
        valueLabel.Text = tostring(default)
        valueLabel.Font = Enum.Font.GothamBold
        valueLabel.TextSize = 13
        valueLabel.TextColor3 = Theme.Accent
        valueLabel.TextXAlignment = Enum.TextXAlignment.Right
        valueLabel.Parent = sliderFrame
        
        local sliderBarBg = Instance.new("Frame")
        sliderBarBg.Size = UDim2.new(1, -24, 0, 6)
        sliderBarBg.Position = UDim2.new(0, 12, 0, 38)
        sliderBarBg.BackgroundColor3 = Theme.Panel
        sliderBarBg.BorderSizePixel = 0
        sliderBarBg.Parent = sliderFrame
        
        Utils.CreateCorner(sliderBarBg, UDim.new(1, 0))
        
        local sliderBar = Instance.new("Frame")
        sliderBar.Size = UDim2.new((default - min) / (max - min), 0, 1, 0)
        sliderBar.BackgroundColor3 = Theme.Accent
        sliderBar.BorderSizePixel = 0
        sliderBar.Parent = sliderBarBg
        
        Utils.CreateCorner(sliderBar, UDim.new(1, 0))
        
        local sliderButton = Instance.new("Frame")
        sliderButton.Size = UDim2.new(0, 16, 0, 16)
        sliderButton.Position = UDim2.new(sliderBar.Size.X.Scale, -8, 0.5, -8)
        sliderButton.BackgroundColor3 = Theme.Text
        sliderButton.BorderSizePixel = 0
        sliderButton.Parent = sliderBarBg
        
        Utils.CreateCorner(sliderButton, UDim.new(1, 0))
        Utils.CreateStroke(sliderButton, Theme.Accent, 2, 0)
        
        local dragging = false
        local currentValue = default
        
        -- Debounced callback
        local debouncedCallback = callback and Utils.Debounce(function(value)
            pcall(callback, value)
        end, 0.05) or nil
        
        local function updateSlider(inputPos)
            local relativeX = math.clamp(inputPos - sliderBarBg.AbsolutePosition.X, 0, sliderBarBg.AbsoluteSize.X)
            local scale = relativeX / sliderBarBg.AbsoluteSize.X
            
            sliderBar.Size = UDim2.new(scale, 0, 1, 0)
            sliderButton.Position = UDim2.new(scale, -8, 0.5, -8)
            
            currentValue = min + scale * (max - min)
            valueLabel.Text = string.format("%.1f", currentValue)
            
            if debouncedCallback then
                debouncedCallback(currentValue)
            end
        end
        
        Tab.Connections:Add(sliderBarBg.InputBegan:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = true
                updateSlider(input.Position.X)
                Utils.Tween(sliderButton, {Size = UDim2.new(0, 20, 0, 20)}, 0.1)
            end
        end))
        
        Tab.Connections:Add(UIS.InputEnded:Connect(function(input)
            if input.UserInputType == Enum.UserInputType.MouseButton1 then
                dragging = false
                Utils.Tween(sliderButton, {Size = UDim2.new(0, 16, 0, 16)}, 0.1)
            end
        end))
        
        Tab.Connections:Add(UIS.InputChanged:Connect(function(input)
            if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
                updateSlider(input.Position.X)
            end
        end))
        
        return sliderFrame, {
            SetValue = function(value)
                currentValue = math.clamp(value, min, max)
                local scale = (currentValue - min) / (max - min)
                sliderBar.Size = UDim2.new(scale, 0, 1, 0)
                sliderButton.Position = UDim2.new(scale, -8, 0.5, -8)
                valueLabel.Text = string.format("%.1f", currentValue)
            end,
            GetValue = function()
                return currentValue
            end
        }
    end
    
    -- Add Label
    function Tab:AddLabel(text)
        local label = Instance.new("TextLabel")
        label.Size = UDim2.new(1, 0, 0, 0)
        label.AutomaticSize = Enum.AutomaticSize.Y
        label.BackgroundTransparency = 1
        label.Text = text
        label.Font = Enum.Font.Gotham
        label.TextSize = 13
        label.TextColor3 = Theme.Muted
        label.TextXAlignment = Enum.TextXAlignment.Left
        label.TextWrapped = true
        label.Parent = page
        
        Utils.CreatePadding(label, {Left = 8, Right = 8, Top = 4, Bottom = 4})
        
        return label
    end
    
    -- Add Divider
    function Tab:AddDivider()
        local divider = Instance.new("Frame")
        divider.Size = UDim2.new(1, -16, 0, 1)
        divider.BackgroundColor3 = Theme.Border
        divider.BorderSizePixel = 0
        divider.Parent = page
        
        return divider
    end
    
    -- Add more components (input, dropdown, keybind, color picker) would follow similar improvements
    
    table.insert(self.Tabs, Tab)
    return Tab
end

-- Cleanup function
function Library:Destroy()
    pcall(function()
        if self.Connections then
            self.Connections:DisconnectAll()
        end
    end)
    
    pcall(function()
        if minConnections then
            minConnections:DisconnectAll()
        end
    end)
    
    pcall(function()
        if dragConnections then
            dragConnections:DisconnectAll()
        end
    end)
    
    if self.Tabs then
        for _, tab in ipairs(self.Tabs) do
            pcall(function()
                if tab and tab.Connections then
                    tab.Connections:DisconnectAll()
                end
            end)
        end
    end
    
    -- Don't destroy the GUI, just search for leftover ESP objects
    print("RoohrHub: Searching for leftover ESP objects...")
    
    local espCount = 0
    for _, obj in ipairs(workspace:GetDescendants()) do
        if obj:IsA("BillboardGui") or obj:IsA("Highlight") or (obj:IsA("BoxHandleAdornment")) then
            if obj.Name:match("ESP") or obj.Name:match("Tracer") or obj.Name:match("Chams") then
                pcall(function()
                    obj:Destroy()
                    espCount = espCount + 1
                end)
            end
        end
    end
    
    -- Check CoreGui for ESP
    local coreGui = game:GetService("CoreGui")
    for _, obj in ipairs(coreGui:GetDescendants()) do
        if obj:IsA("BillboardGui") or obj:IsA("Highlight") then
            if obj.Name:match("ESP") or obj.Name:match("Tracer") or obj.Name:match("Chams") then
                pcall(function()
                    obj:Destroy()
                    espCount = espCount + 1
                end)
            end
        end
    end
    
    print("RoohrHub: Removed " .. espCount .. " leftover ESP objects")
end

-- Welcome notification
task.delay(0.5, function()
    Library:Notify({
        Title = "Welcome!",
        Message = "RoohrHub v2.0 loaded successfully",
        Duration = 3,
        Type = "success"
    })
end)

return Library
